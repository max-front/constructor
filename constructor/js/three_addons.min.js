var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(t){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var e=document.createElement("div");return e.id="webgl-error-message",e.style.fontFamily="monospace",e.style.fontSize="13px",e.style.fontWeight="normal",e.style.textAlign="center",e.style.background="#fff",e.style.color="#000",e.style.padding="1.5em",e.style.width="400px",e.style.margin="5em auto 0",this.webgl||(e.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),e},addGetWebGLMessage:function(e){var t,n,o;e=e||{},t=void 0!==e.parent?e.parent:document.body,n=void 0!==e.id?e.id:"oldie",o=Detector.getWebGLErrorMessage(),o.id=n,t.appendChild(o)}};"object"==typeof module&&(module.exports=Detector),function(){function e(e){this.object=e,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25;var t,n,o=this,i=1e-6,a=0,s=0,r=1,c=new THREE.Vector3,l=!1;this.getPolarAngle=function(){return n},this.getAzimuthalAngle=function(){return t},this.rotateLeft=function(e){s-=e},this.rotateUp=function(e){a-=e},this.panLeft=function(){var e=new THREE.Vector3;return function(t){var n=this.object.matrix.elements;e.set(n[0],n[1],n[2]),e.multiplyScalar(-t),c.add(e)}}(),this.panUp=function(){var e=new THREE.Vector3;return function(t){var n=this.object.matrix.elements;e.set(n[4],n[5],n[6]),e.multiplyScalar(t),c.add(e)}}(),this.pan=function(e,t,n,i){if(o.object instanceof THREE.PerspectiveCamera){var a=o.object.position,s=a.clone().sub(o.target),r=s.length();r*=Math.tan(o.object.fov/2*Math.PI/180),o.panLeft(2*e*r/i),o.panUp(2*t*r/i)}else o.object instanceof THREE.OrthographicCamera?(o.panLeft(e*(o.object.right-o.object.left)/n),o.panUp(t*(o.object.top-o.object.bottom)/i)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(e){o.object instanceof THREE.PerspectiveCamera?r/=e:o.object instanceof THREE.OrthographicCamera?(o.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*e)),o.object.updateProjectionMatrix(),l=!0):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.dollyOut=function(e){o.object instanceof THREE.PerspectiveCamera?r*=e:o.object instanceof THREE.OrthographicCamera?(o.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/e)),o.object.updateProjectionMatrix(),l=!0):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.")},this.update=function(){var o=new THREE.Vector3,h=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),u=h.clone().inverse(),m=new THREE.Vector3,d=new THREE.Quaternion;return function(){var e=this.object.position;o.copy(e).sub(this.target),o.applyQuaternion(h),t=Math.atan2(o.x,o.z),n=Math.atan2(Math.sqrt(o.x*o.x+o.z*o.z),o.y),t+=s,n+=a,t=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,t)),n=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,n)),n=Math.max(i,Math.min(Math.PI-i,n));var p=o.length()*r;return p=Math.max(this.minDistance,Math.min(this.maxDistance,p)),this.target.add(c),o.x=p*Math.sin(n)*Math.sin(t),o.y=p*Math.cos(n),o.z=p*Math.sin(n)*Math.cos(t),o.applyQuaternion(u),e.copy(this.target).add(o),this.object.lookAt(this.target),this.enableDamping===!0?(s*=1-this.dampingFactor,a*=1-this.dampingFactor):(s=0,a=0),r=1,c.set(0,0,0),l||m.distanceToSquared(this.object.position)>i||8*(1-d.dot(this.object.quaternion))>i?(m.copy(this.object.position),d.copy(this.object.quaternion),l=!1,!0):!1}}()}THREE.OrbitControls=function(t,n){function o(e,t){var n=E.domElement===document?E.domElement.body:E.domElement;b.pan(e,t,n.clientWidth,n.clientHeight)}function i(){return 2*Math.PI/60/60*E.autoRotateSpeed}function a(){return Math.pow(.95,E.zoomSpeed)}function s(e){if(E.enabled!==!1){if(e.preventDefault(),e.button===E.mouseButtons.ORBIT){if(E.enableRotate===!1)return;A=P.ROTATE,g.set(e.clientX,e.clientY)}else if(e.button===E.mouseButtons.ZOOM){if(E.enableZoom===!1)return;A=P.DOLLY,R.set(e.clientX,e.clientY)}else if(e.button===E.mouseButtons.PAN){if(E.enablePan===!1)return;A=P.PAN,v.set(e.clientX,e.clientY)}A!==P.NONE&&(document.addEventListener("mousemove",r,!1),document.addEventListener("mouseup",c,!1),E.dispatchEvent(x))}}function r(e){if(E.enabled!==!1){e.preventDefault();var t=E.domElement===document?E.domElement.body:E.domElement;if(A===P.ROTATE){if(E.enableRotate===!1)return;f.set(e.clientX,e.clientY),y.subVectors(f,g),b.rotateLeft(2*Math.PI*y.x/t.clientWidth*E.rotateSpeed),b.rotateUp(2*Math.PI*y.y/t.clientHeight*E.rotateSpeed),g.copy(f)}else if(A===P.DOLLY){if(E.enableZoom===!1)return;O.set(e.clientX,e.clientY),H.subVectors(O,R),H.y>0?b.dollyIn(a()):H.y<0&&b.dollyOut(a()),R.copy(O)}else if(A===P.PAN){if(E.enablePan===!1)return;w.set(e.clientX,e.clientY),T.subVectors(w,v),o(T.x,T.y),v.copy(w)}A!==P.NONE&&E.update()}}function c(){E.enabled!==!1&&(document.removeEventListener("mousemove",r,!1),document.removeEventListener("mouseup",c,!1),E.dispatchEvent(M),A=P.NONE)}function l(e){if(E.enabled!==!1&&E.enableZoom!==!1&&A===P.NONE){e.preventDefault(),e.stopPropagation();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?b.dollyOut(a()):0>t&&b.dollyIn(a()),E.update(),E.dispatchEvent(x),E.dispatchEvent(M)}}function h(e){if(E.enabled!==!1&&E.enableKeys!==!1&&E.enablePan!==!1)switch(e.keyCode){case E.keys.UP:o(0,E.keyPanSpeed),E.update();break;case E.keys.BOTTOM:o(0,-E.keyPanSpeed),E.update();break;case E.keys.LEFT:o(E.keyPanSpeed,0),E.update();break;case E.keys.RIGHT:o(-E.keyPanSpeed,0),E.update()}}function u(e){if(E.enabled!==!1){switch(e.touches.length){case 1:if(E.enableRotate===!1)return;A=P.TOUCH_ROTATE,g.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(E.enableZoom===!1)return;A=P.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);R.set(0,o);break;case 3:if(E.enablePan===!1)return;A=P.TOUCH_PAN,v.set(e.touches[0].pageX,e.touches[0].pageY);break;default:A=P.NONE}A!==P.NONE&&E.dispatchEvent(x)}}function m(e){if(E.enabled!==!1){e.preventDefault(),e.stopPropagation();var t=E.domElement===document?E.domElement.body:E.domElement;switch(e.touches.length){case 1:if(E.enableRotate===!1)return;if(A!==P.TOUCH_ROTATE)return;f.set(e.touches[0].pageX,e.touches[0].pageY),y.subVectors(f,g),b.rotateLeft(2*Math.PI*y.x/t.clientWidth*E.rotateSpeed),b.rotateUp(2*Math.PI*y.y/t.clientHeight*E.rotateSpeed),g.copy(f),E.update();break;case 2:if(E.enableZoom===!1)return;if(A!==P.TOUCH_DOLLY)return;var n=e.touches[0].pageX-e.touches[1].pageX,i=e.touches[0].pageY-e.touches[1].pageY,s=Math.sqrt(n*n+i*i);O.set(0,s),H.subVectors(O,R),H.y>0?b.dollyOut(a()):H.y<0&&b.dollyIn(a()),R.copy(O),E.update();break;case 3:if(E.enablePan===!1)return;if(A!==P.TOUCH_PAN)return;w.set(e.touches[0].pageX,e.touches[0].pageY),T.subVectors(w,v),o(T.x,T.y),v.copy(w),E.update();break;default:A=P.NONE}}}function d(){E.enabled!==!1&&(E.dispatchEvent(M),A=P.NONE)}function p(e){e.preventDefault()}var b=new e(t);this.domElement=void 0!==n?n:document,Object.defineProperty(this,"constraint",{get:function(){return b}}),this.getPolarAngle=function(){return b.getPolarAngle()},this.getAzimuthalAngle=function(){return b.getAzimuthalAngle()},this.enabled=!0,this.center=this.target,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};var E=this,g=new THREE.Vector2,f=new THREE.Vector2,y=new THREE.Vector2,v=new THREE.Vector2,w=new THREE.Vector2,T=new THREE.Vector2,R=new THREE.Vector2,O=new THREE.Vector2,H=new THREE.Vector2,P={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},A=P.NONE;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom;var L={type:"change"},x={type:"start"},M={type:"end"};this.update=function(){this.autoRotate&&A===P.NONE&&b.rotateLeft(i()),b.update()===!0&&this.dispatchEvent(L)},this.reset=function(){A=P.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(L),this.update()},this.dispose=function(){this.domElement.removeEventListener("contextmenu",p,!1),this.domElement.removeEventListener("mousedown",s,!1),this.domElement.removeEventListener("mousewheel",l,!1),this.domElement.removeEventListener("MozMousePixelScroll",l,!1),this.domElement.removeEventListener("touchstart",u,!1),this.domElement.removeEventListener("touchend",d,!1),this.domElement.removeEventListener("touchmove",m,!1),document.removeEventListener("mousemove",r,!1),document.removeEventListener("mouseup",c,!1),window.removeEventListener("keydown",h,!1)},this.domElement.addEventListener("contextmenu",p,!1),this.domElement.addEventListener("mousedown",s,!1),this.domElement.addEventListener("mousewheel",l,!1),this.domElement.addEventListener("MozMousePixelScroll",l,!1),this.domElement.addEventListener("touchstart",u,!1),this.domElement.addEventListener("touchend",d,!1),this.domElement.addEventListener("touchmove",m,!1),window.addEventListener("keydown",h,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,Object.defineProperties(THREE.OrbitControls.prototype,{object:{get:function(){return this.constraint.object}},target:{get:function(){return this.constraint.target},set:function(e){console.warn("THREE.OrbitControls: target is now immutable. Use target.set() instead."),this.constraint.target.copy(e)}},minDistance:{get:function(){return this.constraint.minDistance},set:function(e){this.constraint.minDistance=e}},maxDistance:{get:function(){return this.constraint.maxDistance},set:function(e){this.constraint.maxDistance=e}},minZoom:{get:function(){return this.constraint.minZoom},set:function(e){this.constraint.minZoom=e}},maxZoom:{get:function(){return this.constraint.maxZoom},set:function(e){this.constraint.maxZoom=e}},minPolarAngle:{get:function(){return this.constraint.minPolarAngle},set:function(e){this.constraint.minPolarAngle=e}},maxPolarAngle:{get:function(){return this.constraint.maxPolarAngle},set:function(e){this.constraint.maxPolarAngle=e}},minAzimuthAngle:{get:function(){return this.constraint.minAzimuthAngle},set:function(e){this.constraint.minAzimuthAngle=e}},maxAzimuthAngle:{get:function(){return this.constraint.maxAzimuthAngle},set:function(e){this.constraint.maxAzimuthAngle=e}},enableDamping:{get:function(){return this.constraint.enableDamping},set:function(e){this.constraint.enableDamping=e}},dampingFactor:{get:function(){return this.constraint.dampingFactor},set:function(e){this.constraint.dampingFactor=e}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.constraint.enableDamping},set:function(e){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.constraint.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.constraint.dampingFactor},set:function(e){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.constraint.dampingFactor=e}}})}();
THREE.Mirror=function(r,e,t){THREE.Object3D.call(this),this.name="mirror_"+this.id,t=t||{},this.matrixNeedsUpdate=!0;var i=void 0!==t.textureWidth?t.textureWidth:512,a=void 0!==t.textureHeight?t.textureHeight:512;this.clipBias=void 0!==t.clipBias?t.clipBias:0;var o=void 0!==t.color?new THREE.Color(t.color):new THREE.Color(8355711),s=void 0!==t.spec?option.spec:null;this.renderer=r,this.mirrorPlane=new THREE.Plane,this.normal=new THREE.Vector3(0,0,1),this.mirrorWorldPosition=new THREE.Vector3,this.cameraWorldPosition=new THREE.Vector3,this.rotationMatrix=new THREE.Matrix4,this.lookAtPosition=new THREE.Vector3(0,0,-1),this.clipPlane=new THREE.Vector4,e instanceof THREE.PerspectiveCamera?this.camera=e:(this.camera=new THREE.PerspectiveCamera,console.log(this.name+": camera is not a Perspective Camera!")),this.textureMatrix=new THREE.Matrix4,this.mirrorCamera=this.camera.clone(),this.mirrorCamera.matrixAutoUpdate=!0;var n={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1};this.renderTarget=new THREE.WebGLRenderTarget(i,a,n),this.renderTarget2=new THREE.WebGLRenderTarget(i,a,n);var l={uniforms:{mirrorColor:{value:new THREE.Color(8355711)},mirrorSampler:{value:null},mirrorSpec:{value:null},textureMatrix:{value:new THREE.Matrix4}},vertexShader:["uniform mat4 textureMatrix;","varying vec4 mirrorCoord;","void main() {","	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","	vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","	mirrorCoord = textureMatrix * worldPosition;","	gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["#include <specularmap_pars_fragment>","uniform vec3 mirrorColor;","uniform sampler2D mirrorSampler;","uniform sampler2D mirrorSpec;","varying vec4 mirrorCoord;","float blendOverlay(float base, float blend) {","	return( base < 0.5 ? ( 2.0 * base * blend ) : (1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );","}","void main() {","   #include <specularmap_fragment>","	vec4 color = texture2DProj(mirrorSampler, mirrorCoord);","	color = vec4(blendOverlay(mirrorColor.r, color.r), blendOverlay(mirrorColor.g, color.g), blendOverlay(mirrorColor.b, color.b), 1.0);","	gl_FragColor = color;","}"].join("\n")},m=THREE.UniformsUtils.clone(l.uniforms);this.material=new THREE.ShaderMaterial({fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:m}),this.material.uniforms.mirrorSampler.value=this.renderTarget.texture,this.material.uniforms.mirrorSpec.value=s,this.material.uniforms.mirrorColor.value=o,this.material.uniforms.textureMatrix.value=this.textureMatrix,THREE.Math.isPowerOfTwo(i)&&THREE.Math.isPowerOfTwo(a)||(this.renderTarget.texture.generateMipmaps=!1,this.renderTarget2.texture.generateMipmaps=!1),this.updateTextureMatrix(),this.render()},THREE.Mirror.prototype=Object.create(THREE.Object3D.prototype),Object.assign(THREE.Mirror.prototype,{constructor:THREE.Mirror,renderWithMirror:function(r){this.updateTextureMatrix(),this.matrixNeedsUpdate=!1;var e=r.camera;r.camera=this.mirrorCamera,r.renderTemp(),r.material.uniforms.mirrorSampler.value=r.renderTarget2.texture,this.render(),this.matrixNeedsUpdate=!0,r.material.uniforms.mirrorSampler.value=r.renderTarget.texture,r.camera=e,r.updateTextureMatrix()},updateTextureMatrix:function(){this.updateMatrixWorld(),this.camera.updateMatrixWorld(),this.mirrorWorldPosition.setFromMatrixPosition(this.matrixWorld),this.cameraWorldPosition.setFromMatrixPosition(this.camera.matrixWorld),this.rotationMatrix.extractRotation(this.matrixWorld),this.normal.set(0,0,1),this.normal.applyMatrix4(this.rotationMatrix);var r=this.mirrorWorldPosition.clone().sub(this.cameraWorldPosition);r.reflect(this.normal).negate(),r.add(this.mirrorWorldPosition),this.rotationMatrix.extractRotation(this.camera.matrixWorld),this.lookAtPosition.set(0,0,-1),this.lookAtPosition.applyMatrix4(this.rotationMatrix),this.lookAtPosition.add(this.cameraWorldPosition);var e=this.mirrorWorldPosition.clone().sub(this.lookAtPosition);e.reflect(this.normal).negate(),e.add(this.mirrorWorldPosition),this.up.set(0,-1,0),this.up.applyMatrix4(this.rotationMatrix),this.up.reflect(this.normal).negate(),this.mirrorCamera.position.copy(r),this.mirrorCamera.up=this.up,this.mirrorCamera.lookAt(e),this.mirrorCamera.updateProjectionMatrix(),this.mirrorCamera.updateMatrixWorld(),this.mirrorCamera.matrixWorldInverse.getInverse(this.mirrorCamera.matrixWorld),this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.mirrorCamera.projectionMatrix),this.textureMatrix.multiply(this.mirrorCamera.matrixWorldInverse),this.mirrorPlane.setFromNormalAndCoplanarPoint(this.normal,this.mirrorWorldPosition),this.mirrorPlane.applyMatrix4(this.mirrorCamera.matrixWorldInverse),this.clipPlane.set(this.mirrorPlane.normal.x,this.mirrorPlane.normal.y,this.mirrorPlane.normal.z,this.mirrorPlane.constant);var t=new THREE.Vector4,i=this.mirrorCamera.projectionMatrix;t.x=(Math.sign(this.clipPlane.x)+i.elements[8])/i.elements[0],t.y=(Math.sign(this.clipPlane.y)+i.elements[9])/i.elements[5],t.z=-1,t.w=(1+i.elements[10])/i.elements[14];var a=new THREE.Vector4;a=this.clipPlane.multiplyScalar(2/this.clipPlane.dot(t)),i.elements[2]=a.x,i.elements[6]=a.y,i.elements[10]=a.z+1-this.clipBias,i.elements[14]=a.w},render:function(){this.matrixNeedsUpdate&&this.updateTextureMatrix(),this.matrixNeedsUpdate=!0;for(var r=this;null!==r.parent;)r=r.parent;if(void 0!==r&&r instanceof THREE.Scene){var e=this.material.visible;this.material.visible=!1,this.renderer.render(r,this.mirrorCamera,this.renderTarget,!0),this.material.visible=e}},renderTemp:function(){this.matrixNeedsUpdate&&this.updateTextureMatrix(),this.matrixNeedsUpdate=!0;for(var r=this;null!==r.parent;)r=r.parent;void 0!==r&&r instanceof THREE.Scene&&this.renderer.render(r,this.mirrorCamera,this.renderTarget2,!0)}});
